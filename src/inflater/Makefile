# Library
LIBNAME = inflater
LIBVERSION = 1
LIBSUBVERSION = 0
LIBLINKNAME = lib$(LIBNAME).so
LIBSONAME = $(LIBLINKNAME).$(LIBVERSION)
LIBFULLNAME = $(LIBSONAME).$(LIBSUBVERSION)
LOCALLIBDIR = lib
FULL_LIB_DIR = $(shell pwd)/lib
LIBFULLSPEC = $(LOCALLIBDIR)/$(LIBFULLNAME)

# Tests 
TESTBINDIR = bin
TESTPROGNAME = $(LIBNAME)_tests
TESTPROGOPTS = -Wl,-rpath,$(FULL_LIB_DIR)

# Tools
CXXOPTS = -std=c++14
MKDIR = mkdir
CP = cp
RM = rm
LN = ln

# Sources
SOURCES = \
inflater.cpp

TESTSOURCES = \
inflatertests.cpp

# Targets 
all: $(SOURCES)
	$(MKDIR) -p $(LOCALLIBDIR)
	$(CXX) $(CXXOPTS) -fPIC -shared -o $(LIBFULLSPEC) $(SOURCES) -lz -L/usr/lib/x86_64-linux-gnu
	cd lib && $(LN) -s -f $(LIBFULLNAME) $(LIBSONAME)
	cd lib && $(LN) -s -f $(LIBFULLNAME) $(LIBLINKNAME)

test: $(TESTSOURCES) $(LIBFULLSPEC)
	$(MKDIR) -p $(TESTBINDIR) 
	$(CXX) $(CXXOPTS) $(TESTPROGOPTS) -o $(TESTBINDIR)/$(TESTPROGNAME) $(TESTSOURCES) -L$(FULL_LIB_DIR) -l$(LIBNAME)
	./$(TESTBINDIR)/$(TESTPROGNAME)

clean:
	$(RM) -f $(TESTPROGNAME) $(LOCALLIBDIR)/* $(TESTBINDIR)/*

